# åœ¨åŸç”Ÿ JavaScript ä¸­ï¼Œå®ç°"å­ç»„ä»¶è§¦å‘çˆ¶ç»„ä»¶äº‹ä»¶"

åœ¨**åŸç”Ÿ JavaScriptï¼ˆä¸ä¾èµ–æ¡†æ¶ï¼‰**ä¸­ï¼Œå®ç°"**å­ç»„ä»¶è§¦å‘çˆ¶ç»„ä»¶äº‹ä»¶**"å¸¸è§æœ‰**ä¸¤ç§ä¸»æµæ–¹å¼**ï¼š

---

## âœ… **æ–¹å¼ä¸€ï¼šçˆ¶ç»„ä»¶æŠŠå›è°ƒå‡½æ•°ä¼ ç»™å­ç»„ä»¶ï¼ˆæœ€å¸¸è§ã€æœ€æ¨èï¼‰**

è¿™æ˜¯æœ€æ¥è¿‘æ¡†æ¶ä¸­"props + emit"çš„å®ç°æ–¹å¼ã€‚

### ğŸ“¦ å®ç°æ–¹å¼ 1ï¼šä¼ ç»Ÿ `<script>` æ ‡ç­¾å¼•å…¥

#### `index.html`

```html
<!DOCTYPE html>
<html lang="zh-CN">
	ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
    <h1>æ–¹å¼ä¸€ï¼šçˆ¶ç»„ä»¶ä¼ é€’å›è°ƒå‡½æ•°ç»™å­ç»„ä»¶</h1>
    <div id="parent"></div>

    <!-- å…ˆåŠ è½½å­ç»„ä»¶ï¼Œå†åŠ è½½çˆ¶ç»„ä»¶ -->
    <script src="child.js"></script>
    <script src="parent.js"></script>
  </body>
</html>
```

#### `child.js` - å­ç»„ä»¶

```javascript
function createChild(container, onButtonClick) {
  // åˆ›å»ºå­ç»„ä»¶çš„DOMç»“æ„
  const childBox = document.createElement("div");
  const button = document.createElement("button");
  button.className = "child-button";
  button.textContent = "ç‚¹æˆ‘è§¦å‘çˆ¶ç»„ä»¶äº‹ä»¶";

  const info = document.createElement("p");
  info.textContent = "æˆ‘æ˜¯å­ç»„ä»¶ï¼Œç‚¹å‡»æŒ‰é’®ä¼šé€šçŸ¥çˆ¶ç»„ä»¶";

  // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç»„ä»¶ä¼ æ¥çš„å›è°ƒå‡½æ•°
  button.addEventListener("click", () => {
    const childData = {
      message: "æ¥è‡ªå­ç»„ä»¶çš„æ¶ˆæ¯",
    };
    // è°ƒç”¨çˆ¶ç»„ä»¶ä¼ å…¥çš„å›è°ƒå‡½æ•°
    if (typeof onButtonClick === "function") {
      onButtonClick(childData);
    }
  });

  childBox.appendChild(info);
  childBox.appendChild(button);
  container.appendChild(childBox); --- çœ‹è¿™

}
```

#### `parent.js` - çˆ¶ç»„ä»¶

```javascript
function parentHandleClick(data) {
  console.log("ğŸ‰ çˆ¶ç»„ä»¶æ”¶åˆ°å­ç»„ä»¶çš„æ¶ˆæ¯ï¼š", data);

  // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯
  const messageDiv = document.createElement("div");
  messageDiv.style.cssText = `
    padding: 15px;
    margin: 10px;
    background: #e3f2fd;
    border-left: 4px solid #2196F3;
    border-radius: 4px;
  `;
  messageDiv.innerHTML = `
    <strong>çˆ¶ç»„ä»¶æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š</strong><br>
    æ¶ˆæ¯å†…å®¹: ${data.message}<br>
    æ—¶é—´æˆ³: ${data.timestamp}<br>
    å­ç»„ä»¶ID: ${data.childId}
  `;

  document.getElementById("parent").prepend(messageDiv);
}

// åˆå§‹åŒ–çˆ¶ç»„ä»¶
(function initParent() {
  const parentContainer = document.getElementById("parent");
  // åˆ›å»ºå­ç»„ä»¶ï¼Œå¹¶æŠŠçˆ¶ç»„ä»¶çš„å¤„ç†å‡½æ•°ä¼ è¿›å»
  createChild(parentContainer, parentHandleClick);
})();
```

---

### ğŸ“¦ å®ç°æ–¹å¼ 2ï¼šES6 Module å¯¼å…¥

#### `index.html`

```html
<!DOCTYPE html>
ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
    <h1>æ–¹å¼ä¸€ï¼šå›è°ƒå‡½æ•° - ES6 Moduleç‰ˆæœ¬</h1>
    <div id="app"></div>
    <!-- type="module" å¯ç”¨ES6æ¨¡å— -->
    <script type="module" src="./modules/Parent.js"></script>
  </body>
</html>
```

#### `modules/Child.js` - å­ç»„ä»¶æ¨¡å—

```javascript
/**
 * å­ç»„ä»¶ç±»
 */
export class Child {
  constructor(container, onButtonClick) {
    this.container = container;
    this.onButtonClick = onButtonClick;
    this.element = null;
    this.render();
  }

  /**
   * æ¸²æŸ“å­ç»„ä»¶
   */
  render() {
    this.element = document.createElement("div");
    this.element.className = "child-box";

    const info = document.createElement("p");
    info.textContent = "æˆ‘æ˜¯å­ç»„ä»¶ï¼ˆES6 Moduleç‰ˆï¼‰ï¼Œç‚¹å‡»æŒ‰é’®ä¼šé€šçŸ¥çˆ¶ç»„ä»¶";

    const button = document.createElement("button");
    button.className = "child-button";
    button.textContent = "ç‚¹æˆ‘è§¦å‘çˆ¶ç»„ä»¶äº‹ä»¶ï¼ˆModuleç‰ˆï¼‰";

    // ç»‘å®šäº‹ä»¶
    button.addEventListener("click", () => this.handleClick());  
      -----ã€‹æ•ˆæœç­‰äºbutton.addEventListener("click", this.handleClick;ä½†åè€…æ— æ³•removeEventListeneråœ¨ä¼ å…¥this.handleClickï¼Œå› ä¸ºthisï¼Œé™¤éåè€…æ”¹ä¸ºbutton.addEventListener("click", this.handleClick.bind(this))
                                                                                                   

    this.element.appendChild(info);
    this.element.appendChild(button);
    this.container.appendChild(this.element);

    console.log("âœ… å­ç»„ä»¶ï¼ˆModuleï¼‰å·²æ¸²æŸ“");
  }

  /**
   * å¤„ç†æŒ‰é’®ç‚¹å‡»
   */
  handleClick() {
    const data = {
      message: "æ¥è‡ªå­ç»„ä»¶çš„Moduleæ¶ˆæ¯",
    };

    // è§¦å‘çˆ¶ç»„ä»¶çš„å›è°ƒ
    if (typeof this.onButtonClick === "function") {
      this.onButtonClick(data);
    }
  }

  /**
   * é”€æ¯ç»„ä»¶
   */
  destroy() {
    if (this.element) {
      this.element.remove();
      console.log("ğŸ—‘ï¸ å­ç»„ä»¶å·²é”€æ¯");
    }
  }
}
```

#### `modules/Parent.js` - çˆ¶ç»„ä»¶æ¨¡å—

```javascript
import { Child } from "./Child.js";
class Parent {
  constructor(container) {
    this.container = container;
    this.children = [];
    this.init();
  }

  /**
   * åˆå§‹åŒ–çˆ¶ç»„ä»¶
   */
  init() {
    const title = document.createElement("h2");
    title.textContent = "æˆ‘æ˜¯çˆ¶ç»„ä»¶ï¼ˆES6 Moduleç‰ˆï¼‰";
    title.style.cssText = "color: #2196F3; margin: 20px 0;";
    this.container.appendChild(title);

    const messageArea = document.createElement("div");
    messageArea.id = "message-area";
    this.container.appendChild(messageArea);

    // åˆ›å»ºå­ç»„ä»¶ï¼Œä¼ å…¥å›è°ƒå‡½æ•°
    const child = new Child(
      this.container,
      this.handleChildEvent.bind(this) // ç»‘å®šthisåˆ°çˆ¶ç»„ä»¶
    );
    this.children.push(child);

    console.log("âœ… çˆ¶ç»„ä»¶ï¼ˆModuleï¼‰å·²åˆå§‹åŒ–");
  }

  /**
   * å¤„ç†å­ç»„ä»¶è§¦å‘çš„äº‹ä»¶
   * @param {Object} data - å­ç»„ä»¶ä¼ æ¥çš„æ•°æ®
   */
  handleChildEvent(data) {
    const messageArea = document.getElementById("message-area");
    const messageDiv = document.createElement("div");
    messageDiv.style.cssText = `
		ã€‚ã€‚ã€‚ã€‚ã€‚
    `;
    messageDiv.innerHTML = `
    	ã€‚ã€‚ã€‚ã€‚ã€‚
    `;

    messageArea.prepend(messageDiv);
  }

  /**
   * é”€æ¯æ‰€æœ‰å­ç»„ä»¶
   */
  destroyChildren() {
    this.children.forEach((child) => child.destroy());
    this.children = [];
  }
}

// åˆå§‹åŒ–åº”ç”¨
const app = document.getElementById("app");
const parent = new Parent(app);

// æš´éœ²åˆ°å…¨å±€ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
window.parent = parent;
```

---

## âœ… **æ–¹å¼äºŒï¼šä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ CustomEventï¼ˆé€‚åˆç»„ä»¶è§£è€¦ï¼‰**

### ğŸ“¦ å®ç°æ–¹å¼ 1ï¼šä¼ ç»Ÿ `<script>` æ ‡ç­¾å¼•å…¥

#### `index.html`

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–¹å¼äºŒï¼šCustomEvent - Scriptæ ‡ç­¾</title>
		ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
  </head>
  <body>
    <h1>æ–¹å¼äºŒï¼šä½¿ç”¨ CustomEvent è‡ªå®šä¹‰äº‹ä»¶</h1>
    <div id="parent-container"></div>
    <script src="child-component.js"></script>
    <script src="parent-component.js"></script>
  </body>
</html>
```

#### `child-component.js` - å­ç»„ä»¶

```javascript
/**
 * åˆ›å»ºæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶çš„å­ç»„ä»¶
 * @param {HTMLElement} container - çˆ¶å®¹å™¨
 */
function createEventChild(container) {
	ã€‚ã€‚ã€‚ã€‚

  // ç‚¹å‡»æ—¶æ´¾å‘è‡ªå®šä¹‰äº‹ä»¶
  button.addEventListener("click", () => {
    // åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶
    const customEvent = new CustomEvent("childClick", {
      detail: {
        message: "è¿™æ˜¯é€šè¿‡CustomEventä¼ é€’çš„æ•°æ®",
        timestamp: new Date().toLocaleTimeString(),
        childId: childBox.id,
        count: Math.floor(Math.random() * 100),
      },
      bubbles: true, // å…è®¸äº‹ä»¶å†’æ³¡
      cancelable: true, // å…è®¸å–æ¶ˆäº‹ä»¶
    });

    // æ´¾å‘äº‹ä»¶
    childBox.dispatchEvent(customEvent);
    console.log("ğŸ“¤ å­ç»„ä»¶æ´¾å‘äº†è‡ªå®šä¹‰äº‹ä»¶:", customEvent.detail);
  });

	ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
}
```

#### `parent-component.js` - çˆ¶ç»„ä»¶

```javascript
/**
 * åˆå§‹åŒ–çˆ¶ç»„ä»¶å¹¶ç›‘å¬å­ç»„ä»¶äº‹ä»¶
 */
(function initEventParent() {
 	ã€‚ã€‚ã€‚ã€‚ã€‚
  // çˆ¶ç»„ä»¶ç›‘å¬å­ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶
  child.addEventListener("childClick", (event) => {
  // å¯ä»¥åœ¨çˆ¶å®¹å™¨ä¸Šç›‘å¬ï¼ˆåˆ©ç”¨äº‹ä»¶å†’æ³¡ï¼‰
  parentContainer.addEventListener("childClick", (event) => {
    console.log("ğŸ¯ é€šè¿‡äº‹ä»¶å†’æ³¡åœ¨çˆ¶å®¹å™¨æ•è·:", event.detail);
  });

  console.log("âœ… çˆ¶ç»„ä»¶ï¼ˆCustomEventï¼‰å·²åˆå§‹åŒ–å¹¶ç›‘å¬äº‹ä»¶");
})();
```

---

### ğŸ“¦ å®ç°æ–¹å¼ 2ï¼šES6 Module å¯¼å…¥



#### `index.html`

```html
  <body>
    <h1>æ–¹å¼äºŒï¼šCustomEvent - ES6 Moduleç‰ˆæœ¬</h1>
    <div id="app"></div>
    <script type="module" src="./modules/EventParent.js"></script>
  </body>
</html>
```

#### `modules/EventChild.js` - å­ç»„ä»¶æ¨¡å—

```javascript
/**
 * æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶çš„å­ç»„ä»¶ç±»
 */
export class EventChild {
  constructor(container) {
    this.container = container;
    this.element = null;
    this.clickCount = 0;
    this.render();
  }

  /**
   * æ¸²æŸ“ç»„ä»¶
   */
  render() {
    button.addEventListener("click", () => this.emitCustomEvent());
  }

  /**
   * æ´¾å‘è‡ªå®šä¹‰äº‹ä»¶
   */
  emitCustomEvent() {
    this.clickCount++;

    const eventData = {
      message: "æ¥è‡ªEventChildçš„Moduleæ¶ˆæ¯",
    };

    // åˆ›å»ºå¹¶æ´¾å‘è‡ªå®šä¹‰äº‹ä»¶
    const customEvent = new CustomEvent("childInteraction", {
      detail: eventData,
      bubbles: true,
      cancelable: true,
      composed: true, // å…è®¸ç©¿é€ Shadow DOMï¼ˆå¦‚æœä½¿ç”¨çš„è¯ï¼‰
    });

    this.element.dispatchEvent(customEvent);

  }
   * é”€æ¯ç»„ä»¶
   */
  destroy() {
    if (this.element) {
      this.element.remove();
      console.log("ğŸ—‘ï¸ EventChildå·²é”€æ¯");
    }
  }
}
```

#### `modules/EventParent.js` - çˆ¶ç»„ä»¶æ¨¡å—

```javascript
import { EventChild } from "./EventChild.js";

/**
 * çˆ¶ç»„ä»¶ç±» - ç›‘å¬å­ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶
 */
class EventParent {
  constructor(container) {
      ...
  }

  /**
   * åˆå§‹åŒ–çˆ¶ç»„ä»¶
   */
  init() {
   
    // åˆ›å»ºå­ç»„ä»¶
    this.createChild();

  }

  /**
   * åˆ›å»ºå­ç»„ä»¶å¹¶ç›‘å¬å…¶äº‹ä»¶
   */
  createChild() {
    // åœ¨å­ç»„ä»¶å…ƒç´ ä¸Šç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
    child.getElement().addEventListener("childInteraction", (event) => {
      this.handleChildInteraction(event);
    });

    // ä¹Ÿå¯ä»¥åœ¨çˆ¶å®¹å™¨ä¸Šç›‘å¬ï¼ˆåˆ©ç”¨äº‹ä»¶å†’æ³¡ï¼‰
    this.container.addEventListener(
      "childInteraction",
      (event) => {
        console.log("ğŸ¯ é€šè¿‡äº‹ä»¶å†’æ³¡åœ¨çˆ¶å®¹å™¨æ•è·ï¼ˆModuleï¼‰:", event.detail);
      },
      { once: false }
    ); // ä¸ä½¿ç”¨onceï¼Œå…è®¸å¤šæ¬¡è§¦å‘
  }

  /**
   * å¤„ç†å­ç»„ä»¶çš„äº¤äº’äº‹ä»¶
   * @param {CustomEvent} event - è‡ªå®šä¹‰äº‹ä»¶å¯¹è±¡
   */
  handleChildInteraction(event) {
    // é¼ æ ‡æ‚¬åœæ•ˆæœ
    messageDiv.addEventListener("mouseenter", () => {
      messageDiv.style.transform = "translateX(5px)";
      messageDiv.style.boxShadow = "0 4px 12px rgba(255,152,0,0.4)";
    });

    messageDiv.addEventListener("mouseleave", () => {
      messageDiv.style.transform = "translateX(0)";
      messageDiv.style.boxShadow = "0 2px 8px rgba(255,152,0,0.2)";
    });


  /**
   * é”€æ¯æ‰€æœ‰å­ç»„ä»¶
   */
  destroyChildren() {
    this.children.forEach((child) => child.destroy());
    this.children = [];
    console.log("ğŸ—‘ï¸ æ‰€æœ‰å­ç»„ä»¶å·²é”€æ¯");
  }
}

// åˆå§‹åŒ–åº”ç”¨
const app = document.getElementById("app");
const eventParent = new EventParent(app);

// æš´éœ²åˆ°å…¨å±€ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
window.eventParent = eventParent;
```

